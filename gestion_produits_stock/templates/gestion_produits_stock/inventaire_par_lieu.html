{# C:\MON PROJET\gestion_produits_stock\templates\gestion_produits_stock\inventaire_par_lieu.html #}
{% extends 'gestion_produits_stock/inventaire_base.html' %} {# <--- Cette ligne DOIT être la première #}
{% load gestion_extras %} {# <--- Cette ligne vient APRÈS {% extends %} #}

{% block inventory_content %}

<h3 class="mb-3">Inventaire Détaillé par Lieu de Stockage</h3>

{# Reste du contenu inchangé #}
{% if lieux_stockage %}
    {% for lieu in lieux_stockage %}
    <div class="card mb-4">
        <div class="card-header">
            <h4 class="mb-0"><i class="fas fa-warehouse"></i> {{ lieu.nom }}</h4>
            {% if lieu.adresse %}<small>{{ lieu.adresse }}</small>{% endif %}
        </div>
        <div class="card-body">
            {% with stocks_dans_lieu=produits_par_lieu|get_item:lieu %}
                {% if stocks_dans_lieu %}
                <div class="table-responsive">
                    <table class="table table-striped table-sm">
                        <thead class="table-light">
                            <tr>
                                <th>Produit</th>
                                <th>Quantité</th>
                                <th>Date d'entrée (Lot)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stock_lot in stocks_dans_lieu %}
                            <tr>
                                <td>{{ stock_lot.produit.nom }}</td>
                                <td>{{ stock_lot.quantite }}</td>
                                <td>{{ stock_lot.date_entree|date:"Y-m-d H:i" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="alert alert-info">Aucun produit en stock dans ce lieu actuellement.</p>
                {% endif %}
            {% endwith %}
        </div>
    </div>
    {% endfor %}
{% else %}
<p class="alert alert-info">Aucun lieu de stockage n'est défini.</p>
{% endif %}

{% endblock %}
