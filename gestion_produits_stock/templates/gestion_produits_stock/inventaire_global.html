{# C:\MON PROJET\gestion_produits_stock\templates\gestion_produits_stock\inventaire_global.html #}
{% extends 'gestion_produits_stock/inventaire_base.html' %} {# <--- Cette ligne DOIT être la première #}
{% load gestion_extras %} {# <--- Cette ligne vient APRÈS {% extends %} #}

{% block inventory_content %}

<h3 class="mb-3">Vue d'ensemble de l'Inventaire Global</h3>

{# Reste du contenu inchangé #}
{% if produits_stock_bas %}
<div class="alert alert-warning alert-low-stock" role="alert">
    <i class="fas fa-exclamation-triangle"></i>
    <strong>Alerte Stock Bas :</strong> Les produits suivants sont en dessous de leur seuil minimal !
    <ul>
        {% for produit in produits_stock_bas %}
            <li>{{ produit.nom }} (Actuel: {{ produit.total_quantite_globale }}u, Seuil: {{ produit.seuil_stock_min }}u)</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<h4>Produits en Stock Actuel</h4>
{% if produits_en_stock %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Produit</th>
                <th>Code Produit</th>
                <th>Stock Total Global</th>
                <th>Seuil Min.</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            {% for produit in produits_en_stock %}
            <tr class="{% if produit.est_stock_bas %}alert-low-stock{% endif %}">
                <td>{{ produit.nom }}</td>
                <td>{{ produit.code_produit|default:"N/A" }}</td>
                <td>{{ produit.total_quantite_globale }}</td>
                <td>{{ produit.seuil_stock_min }}</td>
                <td>
                    {% if produit.est_stock_bas %}
                        <span class="badge bg-danger"><i class="fas fa-exclamation-circle"></i> Bas</span>
                    {% else %}
                        <span class="badge bg-success"><i class="fas fa-check-circle"></i> OK</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="alert alert-info">Aucun produit avec du stock enregistré globalement.</p>
{% endif %}

{% endblock %}
